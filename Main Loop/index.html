<!-- <script>
// 基础主循环

main();

function main() {
    console.log('main');

    running = true; // 为了在loop()里能直接修改running值，去掉了var或let

    init(); // 初始化整个体系，框架、图形、声音等等

    loop(); // 主循环

    exit(); // 退出，关闭各种接口等
}

function init() {
    console.log('init');

    // 绑定esc退出游戏循环
    document.onkeydown = keyDown;
}

function loop() {
    console.log('loop');

    while (running) {
        update();   // 执行游戏逻辑
        draw(); // 绘制游戏
    }
}

function update() {
    console.log('update');
}

function draw() {
    console.log('draw');
}

function keyDown() {
    if (event.key === 'Escape') {
        console.log('按了Esc');
        running = false;
    }
}

function exit() {
    console.log('exit');
}
</script> -->


<!-- <script>
// 基于时间的主循环

main();

function main() {
    console.log('main');

    running = true; // 为来在loop()里能直接修改running值，去掉了var或let

    init(); // 初始化整个体系，框架、图形、声音等等

    loop(); // 主循环

    exit(); // 退出，关闭各种接口等
}

function init() {
    console.log('init');

    // 绑定esc退出游戏循环
    document.onkeydown = keyDown;
}

function loop() {
    console.log('loop');

    let totalTime = 0;  // 取得当前时间 或程序运行的总时间
    let lastTime = 0;
    let deltaTime = 0;

    while (running) {
        totalTime = new Date().getTime();
        deltaTime = totalTime - lastTime;
        lastTime =  totalTime;
        
        update(deltaTime);   // 执行游戏逻辑
        draw(); // 绘制游戏
    }
}

function update(deltaTime) {
    console.log('update', deltaTime);
}

function draw() {
    console.log('draw');
}

function keyDown() {
    if (event.key === 'Escape') {
        console.log('按了Esc');
        running = false;
    }
}

function exit() {
    console.log('exit');
}
</script> -->


<!-- <script>
// 基于帧数时间间隔的主循环

main();

function main() {
    console.log('main');

    const TIME_INTERVAL = 1000 / 1; // 循环帧数的间隔，1000毫秒 / 帧数

    running = true; // 为来在loop()里能直接修改running值，去掉了var或let

    init(); // 初始化整个体系，框架、图形、声音等等

    loop(TIME_INTERVAL); // 主循环

    exit(); // 退出，关闭各种接口等
}

function init() {
    console.log('init');

    // 绑定esc退出游戏循环
    document.onkeydown = keyDown;
}

function loop(TIME_INTERVAL) {
    console.log('loop');

    let totalTime = 0;  // 取得当前时间 或程序运行的总时间
    let lastTime = 0;
    let deltaTime = 0;

    while (running) {
        totalTime = new Date().getTime();
        deltaTime = totalTime - lastTime;

        if (deltaTime >= TIME_INTERVAL) {                    
            update();   // 执行游戏逻辑
            draw(); // 绘制游戏
            lastTime = totalTime;
        }
    }
}

function update() {
    console.log('update');
}

function draw() {
    console.log('draw');
}

function keyDown() {
    if (event.key === 'Escape') {
        console.log('按了Esc');
        running = false;
    }
}

function exit() {
    console.log('exit');
}
</script> -->


<script>
// 基于时钟的主循环

var interval;   // 声明 interval，用来标识触发器
var frames = 0; // 当前帧数

main();

function main() {
    console.log('main');

    init(); // 初始化整个体系，框架、图形、声音等等

    interval = setInterval(loop, 1000 / 30); // 主循环; 设定 1000毫秒 / 帧数 毫秒触发一次
}

function init() {
    console.log('init');

    // 绑定esc退出游戏循环
    document.onkeydown = keyDown;
}

function loop() {
    frames++;
    console.log('loop', `第 ${frames} 帧`);

    update();   // 执行游戏逻辑
    draw(); // 绘制游戏
}

function update() {
    console.log('update');
}

function draw() {
    console.log('draw');
}

function keyDown() {
    if (event.key === 'Escape') {
        console.log('按了Esc');
        clearInterval(interval);    // 退出的话，停止事件跟踪
        exit(); // 退出，关闭各种接口等
    }
}

function exit() {
    console.log('exit');
}
</script>